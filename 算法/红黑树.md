# 红黑树

定义：红黑树是二叉查询树的优化版，能够实现自平衡，红黑树的查找与二叉树相同，区别主要在插入或删除节点时，如何实现自平衡。

性质：

+ 性质1：每个节点要么是黑色，要么是红色。

+ 性质2：根节点是黑色。

+ 性质3：每个叶子节点（NIL）是NULL。

+ 性质4：每个红色结点的两个子结点一定都是黑色(即没有相邻互为父子关系的红色节点)。

+ 性质5：任意一结点到每个叶子结点的路径都包含数量相同的黑结点。

常用操作：

1. 左旋：

   ![img](https://upload-images.jianshu.io/upload_images/2392382-a95db442f1b47f8a.png)

2. 右旋同理

## 红黑树插入操作

一些前提和设定：(1)插入的新节点为红色。(2)父亲的父亲节点为祖父节点，父亲的兄弟节点成为叔叔节点

分以下情境（对应代码：

1. 空树直接插入

2. 查完之后发现位置已有数据，进行Update操作（树结构不变化

3. 插入节点的父节点为黑则直接插入

4. 插入节点的父节点为红色则需要分情况

   1. 若叔叔节点为红色（此时父亲和叔叔节点都为红色，那祖父节点一定为黑色），则将祖父节点变为红色，父亲和叔叔节点变为黑色，再将祖父节点做为新节点递归循环以上操作（防止祖父节点的红色与祖父的父亲节点红色冲突）

   2. 若叔叔节点为黑色，则将父亲节点变为黑色，祖父节点变为红色，并进行旋转操作

      ![img](E:\homework\Markdown\img\2392382-ab4097b750826870.png)

   3. 若叔叔节点不存在则同第2点（上面一个

   4. 若插入节点和父节点方向不一致，则可以经过一次旋转就可以将父节点和插入节点调换位置并且方向一致

      ![img](E:\homework\Markdown\img\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwODQzODY1,size_16,color_FFFFFF,t_70)

## 红黑树的删除操作

删除操作更为复杂一些，情境的排列从简单到复杂：

1. 被删节点为红色且为子节点（即红色叶子节点），直接删除，不影响树结构

2. ~~被删节点为红色，且只有一个黑色子节点~~（不存在，违反性质5）

3. 被删节点为黑色，且只有一个红色子节点，将被删节点和子节点的颜色交换，然后删除被删节点

4. 被删节点有两个子节点，此时我们先找到这个被删结点的后继结点successor（前驱节点也可以），然后用successor替换node的值，不用改变颜色，<u>此时转换为删除node的后继节点successor</u>。

   1. 若successor为红色节点（即红色叶子节点），直接删除，不影响树结构
   2. 若successor为黑色节点，根据该黑色节点的子节点情况判断属于哪一种本操作的哪一种情境（循环递归）

5. 被删节点为黑色，且没有子节点（自己就是叶节点），此时情境最复杂，要根据被删节点的父节点、兄弟节点、以及兄弟节点的子节点判断情况，最终目标是消除删除此黑色叶子节点所带来的对树平衡性的影响(（将对树的平衡性影响缩小到对父亲、兄弟以及兄弟子节点的影响）)：

   1. 兄弟节点为黑色、无论父节点颜色、

      1. 当兄弟节点有一个方向一致的红色子节点时,将父亲的颜色（红色或黑色）与兄弟节点互换，兄弟的儿子节点变为黑色，最后进行旋转

         ![20191011193031772](E:\homework\Markdown\img\20191011193031772.png)

      2. 当兄弟节点有一个方向不一致的红色子节点时，先将兄弟节点与兄弟节点儿子旋转，转化成上一种情境![20191011193217935](E:\homework\Markdown\img\20191011193217935.png)

   2. 兄弟节点为黑色，当兄弟节点没有红色子节点时

      1. 若父亲节点为红色，父亲节点与兄弟节点调换颜色即可

      2. 若父亲节点为黑色，此种需要向上递归，将兄弟节点变为红色，父亲节点作为新的被删节点向上递归（实际删除的还是那个黑色叶子节点）

         ![20191011193343281](E:\homework\Markdown\img\20191011193343281.png)

   3. 兄弟节点为红色时，则此时父亲节点为黑色，且兄弟节点的子节点没有红色且至少存在一个或两个黑色子节点：将父节点与兄弟节点颜色互换并旋转

![20191011193516418](E:\homework\Markdown\img\20191011193516418.png)

