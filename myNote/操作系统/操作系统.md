### 操作系统

#### 1. 操作系统简介

1. 操作系统（****Operating     System，简称** **OS****）是管理计算机硬件与软件资源的程序，是计算机系统的内核与基石；
2. 操作系统本质上是运行在计算机上的软件程序** **；**
3. 操作系统为用户提供一个与系统交互的操作界面** **；**
4. 操作系统分内核与外壳（我们可以把外壳理解成围绕着内核的应用程序，而内核就是能操作硬件的程序）。**

#### 2. 进程间的通信

##### 管道/匿名管道(pipe)

- 管道为半双工，若需要双向通信，则需要建立两个管道
- 只能用于父子或兄弟进程
- 单独的文件系统
- 添加时从文件尾添加，读取从头部读取

管道实质：内核缓冲区，以先进先出的规则（循环队列）存取数据。

管道局限：

- 数据单向传输
- 没有名字，只支持具有亲缘关系的进程之间
- 无规定格式的字节流，需要双方自己协定
- 缓冲区大小有限

##### 有名管道（FIFO）

解决匿名管道只能与亲缘关系进程通信的不足。

有名管道以文件的形式存在于文件系统中，即使进程间不存在亲缘关系，通过路径名就可以使用有名管道相互通信。

匿名管道和有名管道严格遵循FIFO，即不支持lseek()文件定位、定位读写等操作。

命名管道是一个设备文件，只要双方能够访问该文件，即能够通信。 

**阻塞问题**：如果写入管道的数据超过其最大值，写操作将阻塞，如果管道中没有数据，读操作将阻塞。

##### 信号（Signal）

信号为异步通信，信号的发送无关目标进程的状态，若目标进程并未处于执行状态，则信号由内核存储起来，直到进程恢复执行。

如果一个信号被进程设置为阻塞，则该信号的传递被延迟，直到其阻塞被取消是才被传递给进程。

信号可以在内核与用户进程间直接交互，内核可用信号来通知用户进程发生了哪些系统事件，主要事件有：

- 硬件来源：用户按下`Ctrl+C`或无效的存储访问、硬件异常等。
- 软件来源：终止进程信号、其他进程调用kill函数、软件异常产生信号。

```
Linux系统中常用信号：
（1）SIGHUP：用户从终端注销，所有已启动进程都将收到该进程。系统缺省状态下对该信号的处理是终止进程。
（2）SIGINT：程序终止信号。程序运行过程中，按Ctrl+C键将产生该信号。
（3）SIGQUIT：程序退出信号。程序运行过程中，按Ctrl+\\键将产生该信号。
（4）SIGBUS和SIGSEGV：进程访问非法地址。
（5）SIGFPE：运算中出现致命错误，如除零操作、数据溢出等。
（6）SIGKILL：用户终止进程执行信号。shell下执行kill -9发送该信号。
（7）SIGTERM：结束进程信号。shell下执行kill 进程pid发送该信号。
（8）SIGALRM：定时器信号。
（9）SIGCLD：子进程退出信号。如果其父进程没有忽略该信号也没有处理该信号，则子进程退出后将形成僵尸进程。
```

信号的执行过程和生命周期

![img](E:\homework\Markdown\myNote\操作系统\操作系统.assets\webp)

##### 消息队列

- 消息队列存放于内核中，当显式删除或内核重启时才被删除。

- 消息队列与管道不同的是队列不需要有接收方等待就可以写入队列。

- 消息队列可以由一个或多个进程读写。
- 消息队列可按消息类型进行筛选的读取。
- 消息队列克服了信号承载信息量少，管道只能承载无格式字 节流以及缓冲区大小受限等缺。
- 目前主要有两种消息队列：1.POSIX队列  2.System  V 队列（大量使用）

##### 共享内存（Share Memory）

多个进程可共同读写内存，是效率最高的IPC。

由于多个进程共享，故需要进行进程同步与互斥。

Linux主要的三种共享内存方式：

- mmap()系统函数的调用
- POSIX共享内存
- System V共享内存

##### 信号量（**semaphore**）

主要用于进程同步，本质上是一个计数器

信号量的操作：

1. 创建信号量，并为其赋初值。
2. 挂起一个信号量，值减一，若小于等于零则阻塞。简称P操作。
3. 挂出一个信号量，值加一，若加一后值大于0则唤起阻塞进程，简称V操作。

信号量的操作应该为原子操作（与普通整型变量不同的原因），由内核维护。

**信号量和互斥量的区别**：

- 互斥量用于线程访问资源的互斥，信号量用于进程的同步

  ```
  互斥：是指某一资源同时只允许一个访问者对其进行访问，具有唯一性和排它性。但互斥无法限制访问者对资源的访问顺序，即访问是无序的。
  同步：是指在互斥的基础上（大多数情况），通过其它机制实现访问者对资源的有序访问。
  ```

  大多数情况下，同步已实现了互斥

- 互斥量只能为0和1，而信号量为非负整数（即互斥量只能控制单个资源的多线程互斥，而同步能控制同类资源的多线程互斥和同步）

- 互斥量的加锁和解锁必须由同一线程分别对应使用，信号量可以由一个线程（生产者）释放，另一个线程（消费者）得到。

##### 套接字（Socket）

![img](E:\homework\Markdown\myNote\操作系统\操作系统.assets\webp1)

可用于跨网络的C/S通信，套接字支持TCP/IP协议的基本通信单元。

套接字的3个特性：

1. 套接字的域：

   - AF_INET：使用IP地址和端口号来指定网络上的某个特定服务。
   - AF_UNIX：指域为文件系统，为文件的读取，地址为文件名。

2. 端口号：

   端口号是一个16位无符号整数

3. 协议类型：

   1. 流套接字：基于TCP/IP，提供有序、可靠的双向字节流传输。
   2. 数据报套接字：基于UDP/IP，不可靠但速度较快。
   3. 原始套接字：始套接字允许对较低层次的协议直接访问，比如IP、 ICMP协议

> **原始套接字与标准套接字的区别在于：**
>
> 原始套接字可以读写内核没有处理的IP数据包
>
> 流套接字只能读取TCP协议的数据
>
> 数据报套接字只能读取UDP协议的数据。
>
> 因此，如果要访问其他协议发送数据必须使用原始套接字。

#### 3.进程的调度算法

##### 批处理系统

1. 先来先服务（FCFS）：非抢占式调度算法，为最先进入队列的进程分配资源。
2. 最短时间优先（SJF）：非抢占式调度算法，根据运行时间最短的顺序进行调度，可能出现长作业一直等待的情况。
3. 最短剩余时间（SRTN）：抢占式调度算法，根据剩余运行时间的顺序进行调度，当一个作业到达时与当前作业的剩余时间进行比较再决定资源的分配。

##### 交互式系统

1. 时间片轮转：每个进程为其分配一个时间片，进程在时间片内得到处理器资源（时间片太小导致进程切换频繁，浪费系统资源，过长则实时性不能得到保证）。
2. 优先级调度：为每个进程分配一个优先级，按优先级进行调度。
3. 多级反馈队列：时间片和优先级调度相结合。

#### 4.内存管理机制

##### 连续分配管理

1. 块式管理：过去操作系统的内存管理模式，每个块中只有一个进程。

##### 非连续分配管理

![image-20200720114854854](E:\homework\Markdown\myNote\操作系统\操作系统.assets\image-20200720114854854.png)

#### 5.分页和分段的区别

页和分段系统有许多相似之处,但在概念上两者完全不同,主要表现在：

1. 页是信息的物理单位,分页是为实现离散分配方式,以消减内存的外零头,提高内存的利用率；或者说,分页仅仅是由于系统管理的需要,而不是用户的需要.

   段是信息的逻辑单位,它含有一组其意义相对完整的信息.分段的目的是为了能更好的满足用户的需要.

2. 页的大小固定且由系统确定,把逻辑地址划分为页号和页内地址两部分,是由机器硬件实现的,因而一个系统只能有一种大小的页面.

   段的长度却不固定,决定于用户所编写的程序,通常由编辑程序在对源程序进行编辑时,根据信息的性质来划分.

3. 分页的作业地址空间是维一的,即单一的线性空间,程序员只须利用一个记忆符,即可表示一地址.

   分段的作业地址空间是二维的,程序员在标识一个地址时,既需给出段名,又需给出段内地址.