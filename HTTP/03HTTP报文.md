# HTTP报文

#### 报文的组成部分

由三部分组成：起始行(start line)、包含属性的首部(header)块，以及数据主体(body)部分。

![image-20200621191253306](E:\homework\Markdown\HTTP\img\image-20200621191253306.png)

起始行 首部是由行 分隔的ASCLL文本

每行以一个由两个字符组成的行终止序列作为结束，这个终止序列也叫做**CRLF**，该序列的两个字符分别(ASCLL:13）和换行符(ASCLL:10)，尽管规范说明应该用CULF来表示终止，但稳健的程序也应该接受单个换行符作为行的终止。

而主体部分是一个可选的数据块，可以包含文本或二进制数据，也可以为空

## HTTP事务

#### 请求报文

请求报文的格式：

```
<method> <request-URL> <version>
<headers>

<entity-body>
```

这是响应报文的格式：

```
<version> <status> <reason-phrass>
<headers>

<entity-body>
```

各部分的简要描述：

1. 方法(method)：

   客户端希望服务器对资源执行的动作。

2. 请求URL(request-URL)：

   所请求资源URL。

3. 版本(version)

   报文所使用的HTTP版本，格式：`HTTP/<major>.<minor>`。

4. 状态码（status-code）：

   三位数字描述了请求过程中发生的情况。每个状态码第一位数字用于描述状态的一般类型。

5. 原因短语(reason-phrase)：

   数字状态码的可读版本，这个对于机器而言不会去读取。

6. 首部（header）：

   首部包含的信息是以键值对的形式，以冒号`(:)`来隔开键值，以CRLF表示结束。

7. 主体部分(entity-body)：

   任意数据组成的数据块。可选模块。

#### 常用的HTTP方法：

| 方法    | 描述                               | 是否包含主体(body) |
| ------- | ---------------------------------- | ------------------ |
| GET     | 从服务器获取一份文档               | 否                 |
| HEAD    | 只从服务器获取文档的首部           | 否                 |
| POST    | 向服务器发送需要处理的数据         | 是                 |
| PUT     | 将请求的主体部分存储来服务器上     | 是                 |
| TRACE   | 对可能经过代理服务器的报文进行追踪 | 否                 |
| OPTIONS | 决定可以在服务器上执行那些方法     | 否                 |
| DELETE  | 从服务器上删除一份文档             | 否                 |

#### 状态码

状态码为每条响应报文的起始行返回的。会返回一个数字状态和一个可读的状态。

通过首位来对不同的状态码进行分类：

| 整体范围  | 已定义范围 | 分类       |
| --------- | ---------- | ---------- |
| 100 ~ 199 | 100 ~ 101  | 信息提示   |
| 200 ~ 299 | 200 ~ 206  | 成功       |
| 300 ~ 399 | 300 ~ 305  | 重定向     |
| 400 ~ 499 | 400 ~ 415  | 客户端错误 |
| 500 ~ 599 | 500 ~ 505  | 服务器错误 |

常见状态码：

1. 200 OK 成功
2. 401 unauthorized 未授权
3. 404 NOT Found 未找到

## 方法

#### 安全方法

所谓安全是指，使用该方法不会在服务器上产生什么结果。GET方法和HEAD方法被认为是安全的。

#### GET方法

太简单了，不记笔记了=v=

#### HEAD方法

和GET方法类似，但是服务器在响应时只返回首部，不返回主体(body)。这就方便对资源的首部检查。还可以：

- 在不获取资源的情况下了解资源的情况，比如通过MIME判断类型
- 通过查看响应中的状态码，查看某个对象是否存在
- 通过查看首部，测试资源是否被修改了。

#### PUT方法

让服务器用请求的主体部分来创建一个由请求的URL命名的新文档，或者那个URL已经存在，则用这个主体来替代它。

#### POST方法

常用于处理表单

#### TRACE方法

当客户端发送一个请求时，在到达服务端的时候可能经过了多次修改，使用TRACE方法服务器会返回达到服务端时的请求报文。故TRACE用来查看代理和其他应用程序对用户请求所产生的效果。

TRACE**请求**中不能带有主体。TRACE的**响应**的主体包含了服务器收到的请求的精确副本。

#### OPTIONS方法

该方法请求服务器告知其支持的各种功能，可以询问服务器支持哪些方法

![image-20200621201742937](E:\homework\Markdown\HTTP\img\image-20200621201742937.png)

#### DELETE方法

请求服务器删除请求URL所指定的资源，但服务器并不保证会执行。

## 状态码

1. #### 信息状态码

   1. 100 Continue：说明服务器收到了请求的初始部分，请客户端继续，客户端收到100 Continue的前提是它发送了100 Continue的Expect请求头部。当客户端愿意在发送实体之前等待100 continue的响应，那他就要发送一个携带了值为100 Continue的Expect的请求头部。
   2. 101 Switching Protocols 服务器正在根据客户端的指定，切换协议

2. #### 成功状态码

   1. OK
   2. Created：用于已创建服务器对象的响应。响应主体部分应该包含各种引用了已创建资源的URL。
   3. Accepted：请求已被接受，但是服务器还未对其执行任何动作
   4. Non-Authoritative Information：实体首部的信息不是来自于源端服务器，而是来自资源的一份副本。

3. #### 重定向状态码：

   告知客户端使用替代的位置来访问资源。通常使用一个重定向状态码和一个可选的Location首部来告知客户端资源已经被移走。

   1. 300 Multiple Choices ：客户端请求一个指向多个资源的URL时会返回这个状态码，比如某个HTML有英语和中文版本，返回该状态码时会带有一个选项列表。
   2. 301 Moved Permanently 在请求的URL已被移除时使用。响应的Location首部应该包含资源现在所处的URL
   3. 302 Found 和301类似，但是客户端使用响应Location首部来临时定位。将来仍然使用老的URL
   4. 303 See Other：告诉客户端应使用另一个URL来获取资源
   5. 304 NOT Modified：客户端可以通过所包含的请求首部，使其请求变成有条件的。
   6. **305 Use Proxy**：说明必须通过一个代理来访问资源
   7. 306 （未使用）
   8. 307 Temporary Redirect：与301类似，但是客户端使用响应Location首部来临时定位。将来仍然使用老的URL

4. #### 客户端错误状态码

   1. 400 Bad Request ：告知客户端发送了一个错误的请求
   2. 401 Unauthorized ：告知客户端在访问资源之前，先对自己进行认证
   3. 402 （未使用）保留
   4. 403 Forbidden：请求被服务器拒绝，可选在主体部分说明原因
   5. 404 NOT Found 
   6. 405 Method NOT Allowed ：表示发起请求中带有请求的URL不支持的方法，应在该响应中包含Allow首部，以告知客户端对所请求的资源可以使用哪些方法
   7. 406 NOT Acceptable ： 客户端可以通过首部Accepted来指定愿意接受什么类型的实体，但当服务器没有与客户端可接受的URL想匹配的资源时，使用该响应码。
   8. 407 Proxy Authentication Required：与401状态码类似，但用于要求资源进行认证的代理服务器
   9. 408 Request Timeout：如果客户端完成请求所花时间太长，服务器可以通过此状态码来关闭连接。
   10. 409 Conflict ：说明请求可能在资源上引发一些冲突。
   11. 410 Gone ：和404类似，不同的是该服务器曾经拥有过该资源，主要用于Web站点的维护
   12. 411 Length Required ：服务器要求客户端在请求报文中添加Content-Length首部
   13. 412 Precondition Failed ： 客户端发起了条件请求，但是其中一个条件失败了
   14. 413 Request Entity Too Large：客户端发送的实体部分过大
   15. 414 Request URI Too Long：客户端请求的URL过长
   16. 415 Unsupported Media Type：服务器无法理解或无法支持客户端所发的实体内容类型
   17. 416 Requested Range Not Satisfiable:
   18. Expectation Failed：请求的Expect包含了一个期望，但服务器无法满足此期望。

5. 服务器错误状态码：

   1. 500 Internal Server Error ：服务器遇到一个妨碍它为请求服务器的错误时
   2. 501 NOTImplemented ：客户端发起的请求超出服务器的能力范围时
   3. 502 Bad Gateway：作为代理或网关使用的服务器在响应链的链路上收到了一条伪响应。
   4. 503 Service Unavailable ：说明服务器现在无法为请求提供服务，但将来可以
   5. 504 Gateway Timeout：来自一个网关或代理，他们在等待时进行响应时超时了
   6. 505 HTTP Version NOT Supported：服务器收到了他无法或不愿意支持的版本协议

## 首部

在请求和响应报文中都可以用首部来提供信息。

1. #### 通用首部

   客户端和服务器都可以使用的首部，比如Date首部就是一个通用首部，以下是通用的信息首部

   | 首部              | 描述                                            |
   | ----------------- | ----------------------------------------------- |
   | Connection        | 允许客户端与服务器指定与请求/响应连接有关的选项 |
   | Date              | 提供日期和时间标志，说明报文是什么时候创建的    |
   | MIME-Version      | 给出了发送端使用的MEME版本                      |
   | Trailer           | 与分块传输编码(chunked transfer encoding)有关   |
   | Transfer-Encoding | 告知接收端报文采用了什么编码方式                |
   | Update            | 给出了发送端可能想要“升级”使用的新版本或协议    |
   | Via               | 显示了报文经过的中间节点(代理、网关)            |

   ```
   Date : Tue, 3 Oct 1874 02:16:00 GMT
   ```

2. #### 请求首部

   他们为服务器提供了一些额外的信息，例如Accept首部就告知服务器客户端会接受与其请求相符的任意媒体类型：

   | 首部       | 描述                                   |
   | ---------- | -------------------------------------- |
   | Client-IP  | 提供了客户端的机器IP地址               |
   | From       | 提供了客户端的EMail地址                |
   | Host       | 给出了接受请求的服务器的主机名和端口号 |
   | Referer    | 提供了当前的URI的文档的URL             |
   | UA-color   | 提供了客户端显示器和显示颜色有关       |
   | UA-CPU     | 提供了客户端的CPU类型                  |
   | UA-Disp    | 提供了客户端显示能力有关信息           |
   | UA-OS      | 提供了客户端机器上的操作系统           |
   | UA-pixels  | 提供了客户端显示器的像素信息           |
   | User-Agent | 将发起请求的应用程序名称告知服务器     |

   除了这些请求首部之外，还有一些其他的首部例如

   1. Accept首部：

      客户端提供了一种将其喜好和能力告知服务器的方式

      | 首部            | 描述                                   |
      | --------------- | -------------------------------------- |
      | Accept          | 告诉服务器能够发送哪些媒体类型         |
      | Accept-Charset  | 告诉服务器能够发送哪些字符集           |
      | Accept-Encoding | 告诉服务器能够发送编码方式             |
      | Accept-Language | 告诉服务器能够发送哪些语言             |
      | TE              | 告诉服务器能够可以使用哪些扩展传输编码 |

   2. 条件请求首部

      客户端希望为请求加上某些限制。要求服务器在对请求进行响应之前，确保某个条件为真。

      | 首部                | 描述                                                   |
      | ------------------- | ------------------------------------------------------ |
      | Expect              | 允许客户端列出请求服务器的行为                         |
      | If-Match            | 如果实体标记与文档当前的实体标记想匹配，就获取这份文档 |
      | If-Modified-Since   | 除非在某个指定日期后资源被修改过，否则就限制该请求     |
      | If-None-Match       |                                                        |
      | If-Range            |                                                        |
      | If-UnModified-Since |                                                        |
      | Range               |                                                        |

   3. 安全请求首部

      客户端在获取特定的资源之前，需要对自身进行认证

      | 首部          | 描述                                                         |
      | ------------- | ------------------------------------------------------------ |
      | Authorization | 包含了客户端提供给服务器，以便对其自身进行认证的数据         |
      | cookie        | 客户端用它向服务器一个令牌，它不是安全首部但是实现了安全的功能 |
      | cookie2       | 用来说明请求端支持的cookie版本                               |

   4. 代理请求首部

      | 首部                | 描述                                                     |
      | ------------------- | -------------------------------------------------------- |
      | Max-Forward         | 允许在转发过程中将请求转发给其他代理或网关的最大次数     |
      | Proxy-Authorization | 与Authorization首部相同该首部是在与代理进行认证时使用的  |
      | Proxy-Connection    | 与Connection首部相同，这个首部是在于代理建立连接时使用的 |

3. #### 响应首部

| 首部        | 描述                             |
| ----------- | -------------------------------- |
| Age         | 响应持续时间                     |
| Public      | 服务器为资源支持的请求方法列表   |
| Retry-After | 若资源不可用，在此时间重试       |
| Serve       | 服务器应用程序软件的名称和版本   |
| Title       | HTML文档的源端给出的标题         |
| Warning     | 比原因短语中更详细一些的警告报文 |

1. 协商首部：服务器可以用来它们来传递与协商资源有关的信息。

| 首部          | 描述                                 |
| ------------- | ------------------------------------ |
| Accept-Ranges | 对此资源来说，服务器可接受的范围类型 |
| Vary          |                                      |

2. 安全响应首部

   HTTP的质询/响应认证机制

   | 首部               | 描述                                                         |
   | ------------------ | ------------------------------------------------------------ |
   | Proxy-Authenticate | 来自代理的对客户端的质询列表                                 |
   | Set-Cookie         | 不是真正的安全首部，但是隐含安全功能，可以在客户端设置一个令牌以便服务器对客户端进行标识 |
   | Set-Cookie2        | 与Set-Cookie类似                                             |
   | WWW-Authenticate   | 来自服务器对客户端的质询列表                                 |

4. #### 实体首部

| 首部     | 描述                             |
| -------- | -------------------------------- |
| Allow    | 列出了可以对此实体执行的请求方法 |
| Location | 告知客户端实体实际上位于何处     |

1. 内容首部

   提供了与实体内容有关的特定信息，说明了其类型、尺寸以及处理它所需的其他有用信息

   | 首部             | 描述                               |
   | ---------------- | ---------------------------------- |
   | Content-Base     | 解析主体中的相对URL时使用的基础URL |
   | Content-Encoding | 对主体执行的任意编码方式           |
   | Content-Language | 理解主体时最适宜使用的自然语言     |
   | Content-Length   | 主体的长度或尺寸                   |
   | Content-Location | 资源实际所处的位置                 |
   | Content-MD5      | 主体的MD5校验和                    |
   | Content-Range    | 在整个资源中此实体表示的字节范围   |
   | Content-Type     | 这个主体的对象类型                 |

2. 实体缓存首部

   这部分主要和实体缓存有关，之后会讲解

   | 首部          | 描述                               |
   | ------------- | ---------------------------------- |
   | ETag          | 与此实体相关的实体标记             |
   | Expires       | 实体失效时间                       |
   | Last-Modified | 这个实体最后一次被修改的日期和时间 |

   